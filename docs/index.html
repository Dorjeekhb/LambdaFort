<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Registro de Licencia</title>
</head>
<body>
  <h2>Registrar licencia automáticamente</h2>
  <button onclick="registrarLicencia()">Solicitar Licencia</button>
  <p id="estado"></p>

  <script>
    async function registrarLicencia() {
      const deviceId = crypto.randomUUID(); // O usa algo persistente en localStorage
      const clave = "3xA!zFh92@7#LmPn2025_secure_key";
      
      const encoder = new TextEncoder();
      const keyData = encoder.encode(clave);
      const msgData = encoder.encode(deviceId);

      const key = await crypto.subtle.importKey(
        "raw", keyData, { name: "HMAC", hash: "SHA-256" }, false, ["sign"]
      );
      const signature = await crypto.subtle.sign("HMAC", key, msgData);
      const firmaHex = Array.from(new Uint8Array(signature)).map(b => b.toString(16).padStart(2, '0')).join('');

      const res = await fetch("https://v3cfc9fokf.execute-api.eu-north-1.amazonaws.com/ValidateRegisterLicense", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ deviceId, firma: firmaHex })
      });

      const data = await res.json();
      document.getElementById("estado").innerText = `✔ ${data.reason}`;
    }
  </script>
</body>
</html>
